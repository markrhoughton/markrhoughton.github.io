<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head><title>Mark Houghton
|
Testing with dates in Dart</title><meta charset=utf-8><meta name=generator content="Hugo 0.119.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Mark Houghton"><meta name=description content="Mobile Engineer, Flutter & iOS Dev, PhD"><link rel=stylesheet href=/scss/main.min.1147aa5bacb4bce677a0e264073829caedb82fd18ea07a5f1d80521f539d1c45.css integrity="sha256-EUeqW6y0vOZ3oOJkBzgpyu24L9GOoHpfHYBSH1OdHEU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=http://example.org/posts/tests-with-date-time/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Testing with dates in Dart"><meta name=twitter:description content="When working with DateTime types it can quickly become awkward to keep methods testable. For example, consider the following code
void someMethodWithDate() { final today = DateTime.now(); // code that uses today } If we need to test this function for a fixed time, then we would have to inject DateTime.now() into the method as an argument. This gets quite messy, either making it nullable and only using it for testing, which feels like a hack"><meta property="og:title" content="Testing with dates in Dart"><meta property="og:description" content="When working with DateTime types it can quickly become awkward to keep methods testable. For example, consider the following code
void someMethodWithDate() { final today = DateTime.now(); // code that uses today } If we need to test this function for a fixed time, then we would have to inject DateTime.now() into the method as an argument. This gets quite messy, either making it nullable and only using it for testing, which feels like a hack"><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/tests-with-date-time/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-05T19:57:26+01:00"><meta property="article:modified_time" content="2023-07-05T19:57:26+01:00"><meta property="og:site_name" content="Mark Houghton"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Testing with dates in Dart","headline":"Testing with dates in Dart","alternativeHeadline":"","description":"
      
        When working with DateTime types it can quickly become awkward to keep methods testable. For example, consider the following code\nvoid someMethodWithDate() { final today = DateTime.now(); \/\/ code that uses today } If we need to test this function for a fixed time, then we would have to inject DateTime.now() into the method as an argument. This gets quite messy, either making it nullable and only using it for testing, which feels like a hack


      


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/example.org\/posts\/tests-with-date-time\/"},"author":{"@type":"Person","name":"Mark Houghton"},"creator":{"@type":"Person","name":"Mark Houghton"},"accountablePerson":{"@type":"Person","name":"Mark Houghton"},"copyrightHolder":{"@type":"Person","name":"Mark Houghton"},"copyrightYear":"2023","dateCreated":"2023-07-05T19:57:26.00Z","datePublished":"2023-07-05T19:57:26.00Z","dateModified":"2023-07-05T19:57:26.00Z","publisher":{"@type":"Organization","name":"Mark Houghton","url":"http://example.org/","logo":{"@type":"ImageObject","url":"http:\/\/example.org\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"http:\/\/example.org\/posts\/tests-with-date-time\/","wordCount":"203","genre":[],"keywords":[]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/profile.jpeg alt="profile picture"><div class=sidebar__introduction-title><a href=/>Mark Houghton</a></div><div class=sidebar__introduction-description><p>Mobile Engineer, Flutter & iOS Dev, PhD</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/mark-r-houghton/ target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://medium.com/@markrhoughton3 target=_blank rel="noopener me" aria-label=Medium title=Medium><i class="fab fa-medium fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:houghton.dev@outlook.com target=_blank rel="noopener me" aria-label=e-mail title=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Mark Houghton
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Home</a></li><li class=nav__list-item><a href=/posts/ title>Blog</a></li><li class=nav__list-item><a href=/portfolio/ title>Projects</a></li><li class=nav__list-item><a href=/about/ title>About Me</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Testing With Dates in Dart</h1><p>When working with <code>DateTime</code> types it can quickly become awkward to keep methods testable.
For example, consider the following code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span>  <span style=color:#66d9ef>void</span> someMethodWithDate() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> today <span style=color:#f92672>=</span> DateTime.now();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// code that uses today
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span></code></pre></div><p>If we need to test this function for a fixed time, then we would have to inject <code>DateTime.now()</code> into the method as an argument.
This gets quite messy, either making it <code>nullable</code> and only using it for testing, which feels like a hack</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span>  <span style=color:#66d9ef>void</span> someMethodWithDate(DateTime<span style=color:#f92672>?</span> time) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> today <span style=color:#f92672>=</span> time <span style=color:#f92672>??</span> DateTime.now();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// code that uses today
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span></code></pre></div><p>or requiring the argument, but then we generate extra bloat whenever calling the method outside of tests</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span>  <span style=color:#66d9ef>void</span> someMethodWithDate(DateTime time) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> today <span style=color:#f92672>=</span> time;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// code that uses today
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span></code></pre></div><p>Neither seem ideal, so we can use the <a href=https://pub.dev/packages/clock>clock package</a> developed by the Dart team instead.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span>  <span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#39;package:clock/clock.dart&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> someMethodWithDate() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> today <span style=color:#f92672>=</span> clock.now();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// code that uses today
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span></code></pre></div><p>With this in place, we can easily fix dates as needed when writing tests</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span>  test(<span style=color:#e6db74>&#39;some unit test that requires fixed time&#39;</span>, () {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// set up
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>final</span> date <span style=color:#f92672>=</span> DateTime.now();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> dummyTime <span style=color:#f92672>=</span> DateTime(date.year, date.month, date.day, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>final</span> result <span style=color:#f92672>=</span> withClock(
</span></span><span style=display:flex><span>      Clock.fixed(dummyTime),
</span></span><span style=display:flex><span>      () <span style=color:#f92672>=&gt;</span> someClass.someMethodWithDate(),
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div></div><div class=post__footer></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Mark Houghton
2023</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body></html>